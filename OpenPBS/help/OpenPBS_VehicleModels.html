<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>OpenPBS.VehicleModels</title>
<meta name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
*       { font-size: 100%; font-family: Arial, sans-serif; }
.modelica, .modelica * { font-size: 90%; font-family: Courier, monospace; white-space: pre; } /* For the Modelica code (in exported html). */
h4      { font-size: 100%; font-weight: bold; color: green; } 
h3      { font-size: 110%; font-weight: bold; color: green; }
h2      { font-size: 130%; font-weight: bold; color: green; }
address { font-weight: normal; }
td      { padding: 2px; border: 1px solid #808080; vertical-align: top; }
th      { padding: 2px; border: 1px solid #808080; vertical-align: top; font-weight: bold; }
table   { border: 1px solid #808080; border-collapse: collapse; }
pre, code {font-family: "Courier New", monospace;}
pre {white-space: pre; overflow-x : hidden;}
.ModelicaDescription {font-weight: bold;} /* For the description string of the class. */
.ModelicaBaseClass {} /* For the list of base-classes at the of the description. */
.ModelicaKeyword { color: blue; font-weight: normal; font-style: normal; } /* Keywords in Modelica. */
.ModelicaComment { color: #006400;  font-weight: normal; font-style: normal;} /* All three variants of comments in Modelica.  */
.ModelicaString { color: #006400;  font-weight: normal; font-style: normal;} /* String constants. */
.ModelicaClass { color: red; font-weight: normal; font-style: normal;} /* Formatting the names of referenced classes (for base-class and components). */
.ModelicaFunction { color: red; font-weight: normal; font-style: normal;} /* Formatting for called functions. */
.ModelicaTablePackageContent { } /* The table of contents for each package. */
.ModelicaTableCrossReference { } /* The optional cross-reference table. */
.ModelicaTableInputs {} /* The table of inputs for a function. */
.ModelicaTableOutputs {} /* The table of outputs for a function. */
.ModelicaTableParameters {} /* The table of parameters for a model/block. */
.ModelicaTableConnectors {} /* The table of connectors for a model/block. */
.ModelicaTableContents {} /* The table of contents for a connector. */
.ModelicaStartAttribute { font-weight: bold; } /* The formatting used for start-attribute in the table of parameters, to separate them from parameter values. */
.ModelicaParameterTab { background-color: #c0c0c0; font-weight: bold; } /* The tab-heading in the table of parameters */
.ModelicaParameterGroup { background-color: #e0e0e0; } /* The group-heading in the table of parameters */
</style>
</head>
<body>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE VehicleModels<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="OpenPBS.VehicleModels"></a><a href="OpenPBS.html#OpenPBS"
>OpenPBS</a>.VehicleModels</h2>
<p>
</p>
<h3>Package Content</h3>
<table summary="Package Content" class="ModelicaTablePackageContent">
<tr>
<th>Name</th>
<th>Description</th>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.FunctionsS.png" alt="OpenPBS.VehicleModels.Functions" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels_Functions.html#OpenPBS.VehicleModels.Functions"
>Functions</a>
</td>
<td>&nbsp;</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.SingleTrackS.png" alt="OpenPBS.VehicleModels.SingleTrack" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.SingleTrack"
>SingleTrack</a>
</td>
<td>Single-track model for lateral dynamics of articulated vehicles</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.SingleTrackS.png" alt="OpenPBS.VehicleModels.SingleTrack_SaturatedTyre" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.SingleTrack_SaturatedTyre"
>SingleTrack_SaturatedTyre</a>
</td>
<td>Single-track model for lateral dynamics of articulated vehicles</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.DirectionInputS.png" alt="OpenPBS.VehicleModels.DirectionInput" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.DirectionInput"
>DirectionInput</a>
</td>
<td>Single track model with direction of travel at front axle as input</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.DirectionInputS.png" alt="OpenPBS.VehicleModels.DirectionInput_SaturatedTyre" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.DirectionInput_SaturatedTyre"
>DirectionInput_SaturatedTyre</a>
</td>
<td>Single track model with direction of travel at front axle as input</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.CurvatureInputS.png" alt="OpenPBS.VehicleModels.CurvatureInput" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.CurvatureInput"
>CurvatureInput</a>
</td>
<td>Steady-state curve</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.VerticalForcesS.png" alt="OpenPBS.VehicleModels.VerticalForces" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.VerticalForces"
>VerticalForces</a>
</td>
<td>&nbsp;</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.VerticalForcesS.png" alt="OpenPBS.VehicleModels.Roll" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.Roll"
>Roll</a>
</td>
<td>&nbsp;</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.VerticalForcesS.png" alt="OpenPBS.VehicleModels.Longitudinal" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.Longitudinal"
>Longitudinal</a>
</td>
<td>&nbsp;</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.Lon829f774761c73fbeionQSS.png" alt="OpenPBS.VehicleModels.LongitudinalAccelerationQS" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.LongitudinalAccelerationQS"
>LongitudinalAccelerationQS</a>
</td>
<td>Use max thrust force distributed on driving axles and solve for the highest inclination angle where the desired acceleration can be achieved</td>
</tr>
<tr>
<td><img src="OpenPBS.VehicleModels.Lon829f774761c73fbeionQSS.png" alt="OpenPBS.VehicleModels.LongitudinalAcceleration" width="20" height="20" align="top">&nbsp;<a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.LongitudinalAcceleration"
>LongitudinalAcceleration</a>
</td>
<td>Use max thrust force distributed on driving axles for dynamic simulation</td>
</tr>
</table>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE SingleTrack<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="OpenPBS.VehicleModels.SingleTrackI.png" alt="OpenPBS.VehicleModels.SingleTrack" align="right" style="border: 1px solid" width="80" height="80">
<a name="OpenPBS.VehicleModels.SingleTrack"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.SingleTrack</h2>
<p>
<span class="ModelicaDescription">Single-track model for lateral dynamics of articulated vehicles</span>
<br>
<br><img src="OpenPBS.VehicleModels.SingleTrackD.png" alt="OpenPBS.VehicleModels.SingleTrack">
</p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>VehicleModel</a></td><td>paramSet</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>mode</td><td>1</td><td>1: Normal, 2: Non-inertial mode, no mass or inertia is considered, 3: Quasistatic, all derivatives are zero</td></tr>
<tr><td>Integer</td><td>nu</td><td>paramSet.nu</td><td>Number of units</td></tr>
<tr><td>Integer</td><td>na</td><td>paramSet.na</td><td>Max number of axles per unit</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>L[nu, na]</td><td>paramSet.L</td><td>Axle positions relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>X[nu]</td><td>paramSet.X</td><td>C.g. position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>A[nu]</td><td>paramSet.A</td><td>Front coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>B[nu]</td><td>paramSet.B</td><td>Rear coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>FOH[nu]</td><td>paramSet.FOH</td><td>Front overhang relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>ROH[nu]</td><td>paramSet.ROH</td><td>Front overhang relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Angle</a></td><td>inclination</td><td>0</td><td>Lateral road inclination [rad]</td></tr>
<tr><td>Boolean</td><td>driven[nu, na]</td><td>paramSet.driven</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Mass</a></td><td>m[nu]</td><td>paramSet.m</td><td>Masses [kg]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Inertia"
>Inertia</a></td><td>I[nu]</td><td>paramSet.I</td><td>Inertias [kg.m2]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Lcog[nu, na]</td><td>L - matrix(X)*ones(1, na)</td><td>Axle positions relative c.g. [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Bcog[nu]</td><td>B - X</td><td>[m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Acog[nu]</td><td>A - X</td><td>[m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Position</a></td><td>rx0[nu, na]</td><td>TM*[0; matrix(B[1:nu - 1] - ...</td><td>[m]</td></tr>
<tr><td>Integer</td><td>TM[nu, nu]</td><td>Functions.tril(nu)</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>rx0_oh[nu, 2]</td><td>cat(2, matrix(rx0[:, 1] + FO...</td><td>Initial position in x-dir of overhang. Front in first colume rear in second. Resolved from first units first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Lcog_oh[nu, 2]</td><td>cat(2, matrix(FOH - X), matr...</td><td>Position of overhang in x-dir from cog, one row for each unit [m]</td></tr>
</table>
<h3>Connectors</h3>
<table summary="Connectors" class="ModelicaTableConnectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>delta_in</td><td>Steering angle at tractor front axle</td></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>vx_in</td><td>First unit velocity input</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>vx_out[nu]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>vy_out[nu]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>wz_out[nu]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>ay_out[nu, na]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>ax_out[nu, na]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>ry_out[nu, na]</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> SingleTrack
  <span class="ModelicaComment">&quot;Single-track model for lateral dynamics of articulated vehicles&quot;</span>
  <span class="ModelicaComment">/* All length parameters positive forward */</span>
  <span class="ModelicaKeyword">parameter </span><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>Vehicles.Base.VehicleModel</a> paramSet;

  <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.VerticalForces"
>OpenPBS.VehicleModels.VerticalForces</a> verticalForces(nu=nu,na=na,paramSet=paramSet);

  <span class="ModelicaKeyword">parameter </span>Integer mode=1
    <span class="ModelicaComment">&quot;1: Normal, 2: Non-inertial mode, no mass or inertia is considered, 3: Quasistatic, all derivatives are zero&quot;</span>;

<span class="ModelicaComment">//   parameter Boolean steadystate=false</span>
<span class="ModelicaComment">//     &quot;True if all derivatives should be set to zero&quot;;</span>
<span class="ModelicaComment">//   /* Dimensions */</span>
<span class="ModelicaComment">//   parameter Boolean noninertial=false</span>
<span class="ModelicaComment">//     &quot;True if inertial effects should be ignored&quot;;</span>

<span class="ModelicaKeyword">parameter </span>Integer nu=paramSet.nu <span class="ModelicaComment">&quot;Number of units&quot;</span>;
<span class="ModelicaKeyword">parameter </span>Integer na=paramSet.na <span class="ModelicaComment">&quot;Max number of axles per unit&quot;</span>;

<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] L=paramSet.L
    <span class="ModelicaComment">&quot;Axle positions relative first axle of each unit&quot;</span>;
<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] X=paramSet.X
    <span class="ModelicaComment">&quot;C.g. position relative first axle&quot;</span>;
<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] A=paramSet.A
    <span class="ModelicaComment">&quot;Front coupling position relative first axle&quot;</span>;
<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] B=paramSet.B
    <span class="ModelicaComment">&quot;Rear coupling position relative first axle&quot;</span>;
    <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] FOH=paramSet.FOH
    <span class="ModelicaComment">&quot;Front overhang relative first axle of each unit&quot;</span>;
     <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] ROH=paramSet.ROH
    <span class="ModelicaComment">&quot;Front overhang relative first axle of each unit&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a> inclination=0 <span class="ModelicaComment">&quot;Lateral road inclination&quot;</span>;

<span class="ModelicaKeyword">parameter </span>Boolean[nu,na] driven=paramSet.driven;

  <span class="ModelicaComment">/* Cornering stiffnesses */</span>
Real[nu,na] C=paramSet.Cc.*verticalForces.Fz
    <span class="ModelicaComment">&quot;Linear cornering stiffness per axle&quot;</span>;

  <span class="ModelicaComment">/* Masses and inertias */</span>
      <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Modelica.SIunits.Mass</a>[nu] m = paramSet.m <span class="ModelicaComment">&quot;Masses&quot;</span>;
    <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Inertia"
>Modelica.SIunits.Inertia</a>[nu] I = paramSet.I <span class="ModelicaComment">&quot;Inertias&quot;</span>;

  <span class="ModelicaComment">/* Inputs */</span>
  <span class="ModelicaComment">  // input Modelica.SIunits.Angle[nu,na] delta_in</span>
    <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> delta_in
    <span class="ModelicaComment">&quot;Steering angle at tractor front axle&quot;</span>;

    <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> vx_in
    <span class="ModelicaComment">&quot;First unit velocity input&quot;</span>;
  <span class="ModelicaComment">/* Outputs */</span>
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> vx_out[nu]=vx;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> vy_out[nu]=vy;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> wz_out[nu]=wz;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> ay_out[nu,na] =<span class="ModelicaFunction"> matrix</span>(d_vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(d_wz)*<span class="ModelicaFunction">ones</span>(1,na))+(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)).*(<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na));
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> ax_out[nu,na] =<span class="ModelicaFunction"> matrix</span>(d_vx)*<span class="ModelicaFunction">ones</span>(1,na)-(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)).*((<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na))+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)));
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> ry_out[nu,na]=ry;
<span class="ModelicaComment">//    Modelica.Blocks.Interfaces.RealOutput front_direction = atan2(vy[1]+Lcog[1,1]*wz[1],vx[1])+pz[1]</span>
<span class="ModelicaComment">//     &quot;Direction of travel at front axle&quot;                                                                                                 annotation (Placement(transformation(extent={{100,-70},{120,-50}})));</span>

  <span class="ModelicaComment">/* Steering angles */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a>[nu,na] delta <span class="ModelicaComment">&quot;Steering angles per axle&quot;</span>;

  <span class="ModelicaComment">/* Accelerations */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a> ax[nu] = d_vx-vy.*wz;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a> ay[nu] = d_vy+vx.*wz;

  <span class="ModelicaComment">/* States */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>Modelica.SIunits.AngularVelocity</a> wz[nu](start=<span class="ModelicaFunction">zeros</span>(nu)) <span class="ModelicaComment">&quot;Yaw rates&quot;</span>;

    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Modelica.SIunits.Velocity</a>[nu] vy(start=<span class="ModelicaFunction">zeros</span>(nu))
    <span class="ModelicaComment">&quot;Lateral velocities at c.g.&quot;</span>;

    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Modelica.SIunits.Velocity</a>[nu] vx <span class="ModelicaComment">&quot;Longitudinal velocities&quot;</span>;

    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a> theta[nu-1] <span class="ModelicaComment">&quot;Articulation angles&quot;</span>;

  <span class="ModelicaComment">/* ---------- Auxiliary variables ---------- */</span>
  <span class="ModelicaComment">/* Slip angles */</span>

   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a> alpha[nu,na] <span class="ModelicaComment">&quot;Slip angle per axle&quot;</span>;

  <span class="ModelicaComment">/* Tire forces */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fxd <span class="ModelicaComment">&quot;Drive force (applied to each driven axle)&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fxw[nu,na] <span class="ModelicaComment">&quot;Wheel longitudinal force&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fyw[nu,na] <span class="ModelicaComment">&quot;Wheel lateral force&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fx[nu,na] <span class="ModelicaComment">&quot;Vehicle longitudinal force per axle&quot;</span>;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fy[nu,na] <span class="ModelicaComment">&quot;Vehicle lateral force per axle&quot;</span>;

  <span class="ModelicaComment">/* Coupling forces */</span>
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fcx[nu-1] <span class="ModelicaComment">&quot;Longitudinal coupling forces&quot;</span>;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fcy[nu-1] <span class="ModelicaComment">&quot;Lateral coupling forces&quot;</span>;

 <span class="ModelicaComment">/* Computed c.g. distances, positive length should give positive c.g. torque for positive (leftward) lateral force*/</span>

  <span class="ModelicaComment">/* Derivative variables */</span>

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a>[nu] d_vx;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a>[nu] d_vy;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>Modelica.SIunits.AngularAcceleration</a>[nu] d_wz;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>Modelica.SIunits.AngularVelocity</a>[nu-1] d_theta;

  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] Lcog = L-<span class="ModelicaFunction">matrix</span>(X)*<span class="ModelicaFunction">ones</span>(1,na)
    <span class="ModelicaComment">&quot;Axle positions relative c.g.&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Bcog = B-X;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Acog = A-X;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] rx0=TM*[0;<span class="ModelicaFunction">matrix</span>(B[1:nu-1]-A[2:nu])]*<span class="ModelicaFunction">ones</span>(1,na)+L;
  <span class="ModelicaKeyword">parameter </span>Integer TM[nu,nu]=<span class="ModelicaFunction">Functions.tril</span>(nu);

  <span class="ModelicaComment">/*Initial coordinates for the over hang. Assume straight starting position. */</span>

  <span class="ModelicaComment"> //Modelica.SIunits.Length[nu] rx01=rx0[:,1];</span>

  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,2] rx0_oh=<span class="ModelicaFunction">cat</span>(2,<span class="ModelicaFunction">matrix</span>(rx0[:,1]+FOH),<span class="ModelicaFunction">matrix</span>(rx0[:,1]+ROH))
  <span class="ModelicaComment">&quot;Initial position in x-dir of overhang. Front in first colume rear in second. Resolved from first units first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,2] Lcog_oh=<span class="ModelicaFunction">cat</span>(2,<span class="ModelicaFunction">matrix</span>(FOH-X),<span class="ModelicaFunction">matrix</span>(ROH-X))
                                                                    <span class="ModelicaComment">&quot;Position of overhang in x-dir from cog, one row for each unit&quot;</span>;
    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] rx(start=rx0);
    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] ry(start=<span class="ModelicaFunction">zeros</span>(nu,na));
    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a>[nu] pz;

  <span class="ModelicaComment">  /*Friction usage. One element for each axle*/</span>
    <span class="ModelicaKeyword">output </span>Real[nu,na] friction_usage=<span class="ModelicaFunction">sqrt</span>(Fx.^2+Fy.^2)./verticalForces.Fz;

<span class="ModelicaKeyword">equation </span>
    <span class="ModelicaKeyword">if </span>mode==1<span class="ModelicaKeyword"> then</span>
        d_vx=<span class="ModelicaFunction">der</span>(vx);

        d_vy=<span class="ModelicaFunction">der</span>(vy);

        d_wz=<span class="ModelicaFunction">der</span>(wz);

        d_theta=<span class="ModelicaFunction">der</span>(theta);
     <span class="ModelicaKeyword">elseif </span>mode==2<span class="ModelicaKeyword"> then</span>
        d_vx=<span class="ModelicaFunction">zeros</span>(nu);

        d_vy=<span class="ModelicaFunction">zeros</span>(nu);

        d_wz=<span class="ModelicaFunction">zeros</span>(nu);

        d_theta=<span class="ModelicaFunction">der</span>(theta);
    <span class="ModelicaKeyword">else</span>
        d_vx=<span class="ModelicaFunction">zeros</span>(nu);

        d_vy=<span class="ModelicaFunction">zeros</span>(nu);

        d_wz=<span class="ModelicaFunction">zeros</span>(nu);

        d_theta=<span class="ModelicaFunction">zeros</span>(nu-1);
    <span class="ModelicaKeyword">end if</span>;

<span class="ModelicaComment">/* Input equations */</span>
vx[1] =<span class="ModelicaFunction"> max</span>(0.1,vx_in);
<span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
  <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">if </span>i==1<span class="ModelicaKeyword"> and </span>j==1<span class="ModelicaKeyword"> then</span>
      delta[i,j]=delta_in;
    <span class="ModelicaKeyword">else</span>
      delta[i,j]=0;
    <span class="ModelicaKeyword">end if</span>;
  <span class="ModelicaKeyword">end for</span>;
<span class="ModelicaKeyword">end for</span>;

<span class="ModelicaComment">/* Slip angles */</span>
alpha = ((<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)))./(<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na))-delta);

<span class="ModelicaComment">/* Tire force */</span>
<span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
  <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">if </span>driven[i,j]<span class="ModelicaKeyword"> then</span>
      Fxw[i,j]=Fxd;
    <span class="ModelicaKeyword">else</span>
      Fxw[i,j]=0;
    <span class="ModelicaKeyword">end if</span>;
  <span class="ModelicaKeyword">end for</span>;
<span class="ModelicaKeyword">end for</span>;

  Fyw = -C.*alpha;

  Fx = Fxw.*<span class="ModelicaFunction">cos</span>(delta)-Fyw.*<span class="ModelicaFunction">sin</span>(delta);
  Fy =Fxw .*<span class="ModelicaFunction"> sin</span>(delta) + Fyw .*<span class="ModelicaFunction"> cos</span>(delta) -<span class="ModelicaFunction"> sin</span>(inclination)*verticalForces.Fz;

<span class="ModelicaComment">/* Kinematic constraints in couplings */</span>
<span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu-1<span class="ModelicaKeyword"> loop</span>
  vx[i+1] = vx[i]*<span class="ModelicaFunction">cos</span>(theta[i])-(vy[i]+Bcog[i]*wz[i])*<span class="ModelicaFunction">sin</span>(theta[i]);
  vy[i+1]+Acog[i+1]*wz[i+1]=(vy[i]+Bcog[i]*wz[i])*<span class="ModelicaFunction">cos</span>(theta[i])+vx[i]*<span class="ModelicaFunction">sin</span>(theta[i]);
<span class="ModelicaKeyword">end for</span>;

(<span class="ModelicaKeyword">if </span>mode==2<span class="ModelicaKeyword"> then </span><span class="ModelicaFunction">zeros</span>(nu)<span class="ModelicaKeyword"> else </span>m).*(d_vx-vy.*wz)=<span class="ModelicaFunction">vector</span>(Fx*<span class="ModelicaFunction">ones</span>(na,1)-[<span class="ModelicaFunction">matrix</span>(Fcx);0]+[0;<span class="ModelicaFunction">matrix</span>(Fcx)].*<span class="ModelicaFunction">cos</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])-[0;<span class="ModelicaFunction">matrix</span>(Fcy)].*<span class="ModelicaFunction">sin</span>([0;<span class="ModelicaFunction">matrix</span>(theta)]));

(<span class="ModelicaKeyword">if </span>mode==2<span class="ModelicaKeyword"> then </span><span class="ModelicaFunction">zeros</span>(nu)<span class="ModelicaKeyword"> else </span>m).*(d_vy+vx.*wz)=<span class="ModelicaFunction">vector</span>(Fy*<span class="ModelicaFunction">ones</span>(na,1)-[<span class="ModelicaFunction">matrix</span>(Fcy);0]+[0;<span class="ModelicaFunction">matrix</span>(Fcx)].*<span class="ModelicaFunction">sin</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])+[0;<span class="ModelicaFunction">matrix</span>(Fcy)].*<span class="ModelicaFunction">cos</span>([0;<span class="ModelicaFunction">matrix</span>(theta)]));

(<span class="ModelicaKeyword">if </span>mode==2<span class="ModelicaKeyword"> then </span><span class="ModelicaFunction">zeros</span>(nu)<span class="ModelicaKeyword"> else </span>I).*d_wz =<span class="ModelicaFunction"> vector</span>(Lcog.*Fy*<span class="ModelicaFunction">ones</span>(na,1)-<span class="ModelicaFunction">matrix</span>(Bcog).*[<span class="ModelicaFunction">matrix</span>(Fcy);0]+<span class="ModelicaFunction">matrix</span>(Acog).*([0;<span class="ModelicaFunction">matrix</span>(Fcx)].*<span class="ModelicaFunction">sin</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])+[0;<span class="ModelicaFunction">matrix</span>(Fcy)].*<span class="ModelicaFunction">cos</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])));

d_theta = wz[1:(nu-1)]-wz[2:nu];

<span class="ModelicaComment">/* Axle global positions */</span>
  <span class="ModelicaFunction">der</span>(pz)=wz;
  <span class="ModelicaFunction">der</span>(rx)=<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na).*(<span class="ModelicaFunction">cos</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na))-(<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na))).*(<span class="ModelicaFunction">sin</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na));
  <span class="ModelicaFunction">der</span>(ry)=<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na).*(<span class="ModelicaFunction">sin</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na))+(<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na))).*(<span class="ModelicaFunction">cos</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na));

<span class="ModelicaKeyword">end </span>SingleTrack;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE SingleTrack_SaturatedTyre<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="OpenPBS.VehicleModels.SingleTrackI.png" alt="OpenPBS.VehicleModels.SingleTrack_SaturatedTyre" align="right" style="border: 1px solid" width="80" height="80">
<a name="OpenPBS.VehicleModels.SingleTrack_SaturatedTyre"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.SingleTrack_SaturatedTyre</h2>
<p>
<span class="ModelicaDescription">Single-track model for lateral dynamics of articulated vehicles</span>
<br>
<br><img src="OpenPBS.VehicleModels.SingleTrackD.png" alt="OpenPBS.VehicleModels.SingleTrack_SaturatedTyre">
</p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>VehicleModel</a></td><td>paramSet</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>mode</td><td>1</td><td>1: Normal, 2: Non-inertial mode, no mass or inertia is considered, 3: Quasistatic, all derivatives are zero</td></tr>
<tr><td>Integer</td><td>nu</td><td>paramSet.nu</td><td>Number of units</td></tr>
<tr><td>Integer</td><td>na</td><td>paramSet.na</td><td>Max number of axles per unit</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>L[nu, na]</td><td>paramSet.L</td><td>Axle positions relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>X[nu]</td><td>paramSet.X</td><td>C.g. position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>A[nu]</td><td>paramSet.A</td><td>Front coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>B[nu]</td><td>paramSet.B</td><td>Rear coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>FOH[nu]</td><td>paramSet.FOH</td><td>Front overhang relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>ROH[nu]</td><td>paramSet.ROH</td><td>Front overhang relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Angle</a></td><td>inclination</td><td>0</td><td>Lateral road inclination [rad]</td></tr>
<tr><td>Boolean</td><td>driven[nu, na]</td><td>paramSet.driven</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Mass</a></td><td>m[nu]</td><td>paramSet.m</td><td>Masses [kg]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Inertia"
>Inertia</a></td><td>I[nu]</td><td>paramSet.I</td><td>Inertias [kg.m2]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Lcog[nu, na]</td><td>L - matrix(X)*ones(1, na)</td><td>Axle positions relative c.g. [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Bcog[nu]</td><td>B - X</td><td>[m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Acog[nu]</td><td>A - X</td><td>[m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Position</a></td><td>rx0[nu, na]</td><td>TM*[0; matrix(B[1:nu - 1] - ...</td><td>[m]</td></tr>
<tr><td>Integer</td><td>TM[nu, nu]</td><td>Functions.tril(nu)</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>rx0_oh[nu, 2]</td><td>cat(2, matrix(rx0[:, 1] + FO...</td><td>Initial position in x-dir of overhang. Front in first colume rear in second. Resolved from first units first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>Lcog_oh[nu, 2]</td><td>cat(2, matrix(FOH - X), matr...</td><td>Position of overhang in x-dir from cog, one row for each unit [m]</td></tr>
<tr><td>Real</td><td>mu</td><td>&nbsp;</td><td>Friction coefficient</td></tr>
</table>
<h3>Connectors</h3>
<table summary="Connectors" class="ModelicaTableConnectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>delta_in</td><td>Steering angle at tractor front axle</td></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>vx_in</td><td>First unit velocity input</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>vx_out[nu]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>vy_out[nu]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>wz_out[nu]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>ay_out[nu, na]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>ax_out[nu, na]</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>ry_out[nu, na]</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> SingleTrack_SaturatedTyre
  <span class="ModelicaComment">&quot;Single-track model for lateral dynamics of articulated vehicles&quot;</span>
  <span class="ModelicaComment">/* All length parameters positive forward */</span>
  <span class="ModelicaKeyword">parameter </span><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>Vehicles.Base.VehicleModel</a> paramSet;

  <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.VerticalForces"
>OpenPBS.VehicleModels.VerticalForces</a> verticalForces(nu=nu,na=na,paramSet=paramSet);

  <span class="ModelicaKeyword">parameter </span>Integer mode=1
    <span class="ModelicaComment">&quot;1: Normal, 2: Non-inertial mode, no mass or inertia is considered, 3: Quasistatic, all derivatives are zero&quot;</span>;

<span class="ModelicaComment">//   parameter Boolean steadystate=false</span>
<span class="ModelicaComment">//     &quot;True if all derivatives should be set to zero&quot;;</span>
<span class="ModelicaComment">//   /* Dimensions */</span>
<span class="ModelicaComment">//   parameter Boolean noninertial=false</span>
<span class="ModelicaComment">//     &quot;True if inertial effects should be ignored&quot;;</span>

<span class="ModelicaKeyword">parameter </span>Integer nu=paramSet.nu <span class="ModelicaComment">&quot;Number of units&quot;</span>;
<span class="ModelicaKeyword">parameter </span>Integer na=paramSet.na <span class="ModelicaComment">&quot;Max number of axles per unit&quot;</span>;

<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] L=paramSet.L
    <span class="ModelicaComment">&quot;Axle positions relative first axle of each unit&quot;</span>;
<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] X=paramSet.X
    <span class="ModelicaComment">&quot;C.g. position relative first axle&quot;</span>;
<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] A=paramSet.A
    <span class="ModelicaComment">&quot;Front coupling position relative first axle&quot;</span>;
<span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] B=paramSet.B
    <span class="ModelicaComment">&quot;Rear coupling position relative first axle&quot;</span>;
    <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] FOH=paramSet.FOH
    <span class="ModelicaComment">&quot;Front overhang relative first axle of each unit&quot;</span>;
     <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] ROH=paramSet.ROH
    <span class="ModelicaComment">&quot;Front overhang relative first axle of each unit&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a> inclination=0 <span class="ModelicaComment">&quot;Lateral road inclination&quot;</span>;

<span class="ModelicaKeyword">parameter </span>Boolean[nu,na] driven=paramSet.driven;

  <span class="ModelicaComment">/* Cornering stiffnesses */</span>
Real[nu,na] C=paramSet.Cc.*verticalForces.Fz
    <span class="ModelicaComment">&quot;Linear cornering stiffness per axle&quot;</span>;

  <span class="ModelicaComment">/* Masses and inertias */</span>
      <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Modelica.SIunits.Mass</a>[nu] m = paramSet.m <span class="ModelicaComment">&quot;Masses&quot;</span>;
    <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Inertia"
>Modelica.SIunits.Inertia</a>[nu] I = paramSet.I <span class="ModelicaComment">&quot;Inertias&quot;</span>;

  <span class="ModelicaComment">/* Inputs */</span>
  <span class="ModelicaComment">  // input Modelica.SIunits.Angle[nu,na] delta_in</span>
    <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> delta_in
    <span class="ModelicaComment">&quot;Steering angle at tractor front axle&quot;</span>;

    <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> vx_in
    <span class="ModelicaComment">&quot;First unit velocity input&quot;</span>;
  <span class="ModelicaComment">/* Outputs */</span>
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> vx_out[nu]=vx;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> vy_out[nu]=vy;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> wz_out[nu]=wz;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> ay_out[nu,na] =<span class="ModelicaFunction"> matrix</span>(d_vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(d_wz)*<span class="ModelicaFunction">ones</span>(1,na))+(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)).*(<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na));
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> ax_out[nu,na] =<span class="ModelicaFunction"> matrix</span>(d_vx)*<span class="ModelicaFunction">ones</span>(1,na)-(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)).*((<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na))+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)));
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> ry_out[nu,na]=ry;
<span class="ModelicaComment">//    Modelica.Blocks.Interfaces.RealOutput front_direction = atan2(vy[1]+Lcog[1,1]*wz[1],vx[1])+pz[1]</span>
<span class="ModelicaComment">//     &quot;Direction of travel at front axle&quot;                                                                                                 annotation (Placement(transformation(extent={{100,-70},{120,-50}})));</span>

  <span class="ModelicaComment">/* Steering angles */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a>[nu,na] delta <span class="ModelicaComment">&quot;Steering angles per axle&quot;</span>;

  <span class="ModelicaComment">/* Accelerations */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a> ax[nu] = d_vx-vy.*wz;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a> ay[nu] = d_vy+vx.*wz;

  <span class="ModelicaComment">/* States */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>Modelica.SIunits.AngularVelocity</a> wz[nu](start=<span class="ModelicaFunction">zeros</span>(nu)) <span class="ModelicaComment">&quot;Yaw rates&quot;</span>;

    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Modelica.SIunits.Velocity</a>[nu] vy(start=<span class="ModelicaFunction">zeros</span>(nu))
    <span class="ModelicaComment">&quot;Lateral velocities at c.g.&quot;</span>;

    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Modelica.SIunits.Velocity</a>[nu] vx <span class="ModelicaComment">&quot;Longitudinal velocities&quot;</span>;

    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a> theta[nu-1] <span class="ModelicaComment">&quot;Articulation angles&quot;</span>;

  <span class="ModelicaComment">/* ---------- Auxiliary variables ---------- */</span>
  <span class="ModelicaComment">/* Slip angles */</span>

   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a> alpha[nu,na] <span class="ModelicaComment">&quot;Slip angle per axle&quot;</span>;

  <span class="ModelicaComment">/* Tire forces */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fxd <span class="ModelicaComment">&quot;Drive force (applied to each driven axle)&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fxw[nu,na] <span class="ModelicaComment">&quot;Wheel longitudinal force&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fyw[nu,na] <span class="ModelicaComment">&quot;Wheel lateral force&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fx[nu,na] <span class="ModelicaComment">&quot;Vehicle longitudinal force per axle&quot;</span>;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fy[nu,na] <span class="ModelicaComment">&quot;Vehicle lateral force per axle&quot;</span>;

  <span class="ModelicaComment">/* Coupling forces */</span>
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fcx[nu-1] <span class="ModelicaComment">&quot;Longitudinal coupling forces&quot;</span>;
   <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fcy[nu-1] <span class="ModelicaComment">&quot;Lateral coupling forces&quot;</span>;

 <span class="ModelicaComment">/* Computed c.g. distances, positive length should give positive c.g. torque for positive (leftward) lateral force*/</span>

  <span class="ModelicaComment">/* Derivative variables */</span>

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a>[nu] d_vx;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a>[nu] d_vy;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>Modelica.SIunits.AngularAcceleration</a>[nu] d_wz;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>Modelica.SIunits.AngularVelocity</a>[nu-1] d_theta;

  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] Lcog = L-<span class="ModelicaFunction">matrix</span>(X)*<span class="ModelicaFunction">ones</span>(1,na)
    <span class="ModelicaComment">&quot;Axle positions relative c.g.&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Bcog = B-X;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Acog = A-X;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] rx0=TM*[0;<span class="ModelicaFunction">matrix</span>(B[1:nu-1]-A[2:nu])]*<span class="ModelicaFunction">ones</span>(1,na)+L;
  <span class="ModelicaKeyword">parameter </span>Integer TM[nu,nu]=<span class="ModelicaFunction">Functions.tril</span>(nu);

  <span class="ModelicaComment">/*Initial coordinates for the over hang. Assume straight starting position. */</span>

  <span class="ModelicaComment"> //Modelica.SIunits.Length[nu] rx01=rx0[:,1];</span>

  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,2] rx0_oh=<span class="ModelicaFunction">cat</span>(2,<span class="ModelicaFunction">matrix</span>(rx0[:,1]+FOH),<span class="ModelicaFunction">matrix</span>(rx0[:,1]+ROH))
  <span class="ModelicaComment">&quot;Initial position in x-dir of overhang. Front in first colume rear in second. Resolved from first units first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,2] Lcog_oh=<span class="ModelicaFunction">cat</span>(2,<span class="ModelicaFunction">matrix</span>(FOH-X),<span class="ModelicaFunction">matrix</span>(ROH-X))
                                                                    <span class="ModelicaComment">&quot;Position of overhang in x-dir from cog, one row for each unit&quot;</span>;
    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] rx(start=rx0);
    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] ry(start=<span class="ModelicaFunction">zeros</span>(nu,na));
    <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a>[nu] pz;

  <span class="ModelicaComment">  /*Friction usage. One element for each axle*/</span>
    <span class="ModelicaKeyword">output </span>Real[nu,na] friction_usage=<span class="ModelicaFunction">sqrt</span>(Fx.^2+Fy.^2)./verticalForces.Fz;

    <span class="ModelicaKeyword">parameter </span>Real mu <span class="ModelicaComment">&quot;Friction coefficient&quot;</span>;

<span class="ModelicaKeyword">equation </span>
    <span class="ModelicaKeyword">if </span>mode==1<span class="ModelicaKeyword"> then</span>
        d_vx=<span class="ModelicaFunction">der</span>(vx);
        d_vy=<span class="ModelicaFunction">der</span>(vy);
        d_wz=<span class="ModelicaFunction">der</span>(wz);
        d_theta=<span class="ModelicaFunction">der</span>(theta);
     <span class="ModelicaKeyword">elseif </span>mode==2<span class="ModelicaKeyword"> then</span>
        d_vx=<span class="ModelicaFunction">zeros</span>(nu);
        d_vy=<span class="ModelicaFunction">zeros</span>(nu);
        d_wz=<span class="ModelicaFunction">zeros</span>(nu);
        d_theta=<span class="ModelicaFunction">der</span>(theta);
    <span class="ModelicaKeyword">else</span>
        d_vx=<span class="ModelicaFunction">zeros</span>(nu);
        d_vy=<span class="ModelicaFunction">zeros</span>(nu);
        d_wz=<span class="ModelicaFunction">zeros</span>(nu);
        d_theta=<span class="ModelicaFunction">zeros</span>(nu-1);
    <span class="ModelicaKeyword">end if</span>;

<span class="ModelicaComment">/* Input equations */</span>
vx[1] =<span class="ModelicaFunction"> max</span>(0.1,vx_in);
<span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
  <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">if </span>i==1<span class="ModelicaKeyword"> and </span>j==1<span class="ModelicaKeyword"> then</span>
      delta[i,j]=delta_in;
    <span class="ModelicaKeyword">else</span>
      delta[i,j]=0;
    <span class="ModelicaKeyword">end if</span>;
  <span class="ModelicaKeyword">end for</span>;
<span class="ModelicaKeyword">end for</span>;

<span class="ModelicaComment">/* Slip angles */</span>
alpha = ((<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na)))./(<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na))-delta);


  <span class="ModelicaComment">/* Tire force */</span>
  <span class="ModelicaComment">//Tyre-Longitudinal</span>
  <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
      <span class="ModelicaKeyword">if </span>driven[i, j]<span class="ModelicaKeyword"> then</span>
        Fxw[i, j] = Fxd;
      <span class="ModelicaKeyword">else</span>
        Fxw[i, j] = 0;
      <span class="ModelicaKeyword">end if</span>;
    <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaComment">//Tyre-Lateral</span>
  <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
<span class="ModelicaComment">//       //Change step 2:</span>
       <span class="ModelicaKeyword">if </span>driven[i, j]<span class="ModelicaKeyword"> then</span>
         Fyw[i, j] = -<span class="ModelicaFunction">sign</span>(alpha[i, j])*<span class="ModelicaFunction">min</span>(C[i, j]*<span class="ModelicaFunction">abs</span>(alpha[i, j]), mu*verticalForces.Fz[i, j])*<span class="ModelicaFunction">sqrt</span>(1-((Fyw[i, j]/(mu*verticalForces.Fz[i, j]))^2));
       <span class="ModelicaKeyword">else</span>
         Fyw[i, j] = -<span class="ModelicaFunction">sign</span>(alpha[i, j])*<span class="ModelicaFunction">min</span>(C[i, j]*<span class="ModelicaFunction">abs</span>(alpha[i, j]), mu*verticalForces.Fz[i, j]);
       <span class="ModelicaKeyword">end if</span>;
<span class="ModelicaComment">//       //Change step 1:</span>
<span class="ModelicaComment">//        if driven[i, j] then</span>
<span class="ModelicaComment">//          Fyw[i, j] = -C[i, j]*alpha[i, j];</span>
<span class="ModelicaComment">//        else</span>
<span class="ModelicaComment">//          Fyw[i, j] = -sign(alpha[i, j])*min(C[i, j]*abs(alpha[i, j]), mu*verticalForces.Fz[i, j]);</span>
<span class="ModelicaComment">//        end if;</span>
<span class="ModelicaComment">//       //No change:</span>
<span class="ModelicaComment">//          Fyw[i, j] = -C[i, j]*alpha[i, j];</span>
    <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaComment">//Transfromation between tyre and vehicle units coordinate systems</span>
  Fx = Fxw .*<span class="ModelicaFunction"> cos</span>(delta) - Fyw .*<span class="ModelicaFunction"> sin</span>(delta);
  Fy = Fxw .*<span class="ModelicaFunction"> sin</span>(delta) + Fyw .*<span class="ModelicaFunction"> cos</span>(delta) -<span class="ModelicaFunction"> sin</span>(inclination)*verticalForces.Fz;


<span class="ModelicaComment">/* Kinematic constraints in couplings */</span>
<span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu-1<span class="ModelicaKeyword"> loop</span>
  vx[i+1] = vx[i]*<span class="ModelicaFunction">cos</span>(theta[i])-(vy[i]+Bcog[i]*wz[i])*<span class="ModelicaFunction">sin</span>(theta[i]);
  vy[i+1]+Acog[i+1]*wz[i+1]=(vy[i]+Bcog[i]*wz[i])*<span class="ModelicaFunction">cos</span>(theta[i])+vx[i]*<span class="ModelicaFunction">sin</span>(theta[i]);
<span class="ModelicaKeyword">end for</span>;

(<span class="ModelicaKeyword">if </span>mode==2<span class="ModelicaKeyword"> then </span><span class="ModelicaFunction">zeros</span>(nu)<span class="ModelicaKeyword"> else </span>m).*(d_vx-vy.*wz)=<span class="ModelicaFunction">vector</span>(Fx*<span class="ModelicaFunction">ones</span>(na,1)-[<span class="ModelicaFunction">matrix</span>(Fcx);0]+[0;<span class="ModelicaFunction">matrix</span>(Fcx)].*<span class="ModelicaFunction">cos</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])-[0;<span class="ModelicaFunction">matrix</span>(Fcy)].*<span class="ModelicaFunction">sin</span>([0;<span class="ModelicaFunction">matrix</span>(theta)]));

(<span class="ModelicaKeyword">if </span>mode==2<span class="ModelicaKeyword"> then </span><span class="ModelicaFunction">zeros</span>(nu)<span class="ModelicaKeyword"> else </span>m).*(d_vy+vx.*wz)=<span class="ModelicaFunction">vector</span>(Fy*<span class="ModelicaFunction">ones</span>(na,1)-[<span class="ModelicaFunction">matrix</span>(Fcy);0]+[0;<span class="ModelicaFunction">matrix</span>(Fcx)].*<span class="ModelicaFunction">sin</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])+[0;<span class="ModelicaFunction">matrix</span>(Fcy)].*<span class="ModelicaFunction">cos</span>([0;<span class="ModelicaFunction">matrix</span>(theta)]));

(<span class="ModelicaKeyword">if </span>mode==2<span class="ModelicaKeyword"> then </span><span class="ModelicaFunction">zeros</span>(nu)<span class="ModelicaKeyword"> else </span>I).*d_wz =<span class="ModelicaFunction"> vector</span>(Lcog.*Fy*<span class="ModelicaFunction">ones</span>(na,1)-<span class="ModelicaFunction">matrix</span>(Bcog).*[<span class="ModelicaFunction">matrix</span>(Fcy);0]+<span class="ModelicaFunction">matrix</span>(Acog).*([0;<span class="ModelicaFunction">matrix</span>(Fcx)].*<span class="ModelicaFunction">sin</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])+[0;<span class="ModelicaFunction">matrix</span>(Fcy)].*<span class="ModelicaFunction">cos</span>([0;<span class="ModelicaFunction">matrix</span>(theta)])));

d_theta = wz[1:(nu-1)]-wz[2:nu];

<span class="ModelicaComment">/* Axle global positions */</span>
  <span class="ModelicaFunction">der</span>(pz)=wz;
  <span class="ModelicaFunction">der</span>(rx)=<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na).*(<span class="ModelicaFunction">cos</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na))-(<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na))).*(<span class="ModelicaFunction">sin</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na));
  <span class="ModelicaFunction">der</span>(ry)=<span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na).*(<span class="ModelicaFunction">sin</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na))+(<span class="ModelicaFunction">matrix</span>(vy)*<span class="ModelicaFunction">ones</span>(1,na)+Lcog.*(<span class="ModelicaFunction">matrix</span>(wz)*<span class="ModelicaFunction">ones</span>(1,na))).*(<span class="ModelicaFunction">cos</span>(<span class="ModelicaFunction">matrix</span>(pz))*<span class="ModelicaFunction">ones</span>(1,na));

<span class="ModelicaKeyword">end </span>SingleTrack_SaturatedTyre;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE DirectionInput<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="OpenPBS.VehicleModels.DirectionInputI.png" alt="OpenPBS.VehicleModels.DirectionInput" align="right" style="border: 1px solid" width="80" height="80">
<a name="OpenPBS.VehicleModels.DirectionInput"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.DirectionInput</h2>
<p>
<span class="ModelicaDescription">Single track model with direction of travel at front axle as input</span>
<br>
<br><img src="OpenPBS.VehicleModels.DirectionInputD.png" alt="OpenPBS.VehicleModels.DirectionInput">
</p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td>Integer</td><td>nu</td><td>2</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>na</td><td>3</td><td>&nbsp;</td></tr>
<tr><td><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>VehicleModel</a></td><td>paramSet</td><td>&nbsp;</td><td>&nbsp;</td></tr>
</table>
<h3>Connectors</h3>
<table summary="Connectors" class="ModelicaTableConnectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>delta_out</td><td>&nbsp;</td></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>front_direction_in</td><td>Direction of travel at first axle</td></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>vx_in</td><td>First unit velocity input</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> DirectionInput
  <span class="ModelicaComment">&quot;Single track model with direction of travel at front axle as input&quot;</span>
  <span class="ModelicaKeyword">parameter </span>Integer nu=2;
  <span class="ModelicaKeyword">parameter </span>Integer na=3;

  <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.SingleTrack"
>VehicleModels.SingleTrack</a> vehicle(            mode=2, paramSet=paramSet,
    nu=nu,
    na=na);
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.InverseBlockConstraints"
>Modelica.Blocks.Math.InverseBlockConstraints</a> inverseBlockConstraints;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> delta_out;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> front_direction_in
    <span class="ModelicaComment">&quot;Direction of travel at first axle&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> vx_in <span class="ModelicaComment">&quot;First unit velocity input&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Atan2"
>Modelica.Blocks.Math.Atan2</a> headingAngle;
  <a href="OpenPBS_Components.html#OpenPBS.Components.MotionOffset"
>Components.MotionOffset</a> motionOffset(y_offset=-paramSet.w[1, 1]/2,
      x_offset=vehicle.Lcog[1, 1]);
  <span class="ModelicaKeyword">parameter </span><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>Vehicles.Base.VehicleModel</a> paramSet;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.RealExpression"
>Modelica.Blocks.Sources.RealExpression</a> realExpression2(y=vehicle.pz[1]);
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Add"
>Modelica.Blocks.Math.Add</a> add;
<span class="ModelicaKeyword">equation </span>

  <span class="ModelicaFunction">connect</span>(vehicle.delta_in, inverseBlockConstraints.y2);
  <span class="ModelicaFunction">connect</span>(inverseBlockConstraints.u1, front_direction_in);
  <span class="ModelicaFunction">connect</span>(vehicle.vx_in, vx_in);
  <span class="ModelicaFunction">connect</span>(inverseBlockConstraints.y1, delta_out);
  <span class="ModelicaFunction">connect</span>(vehicle.vx_out[1], motionOffset.vx);
  <span class="ModelicaFunction">connect</span>(vehicle.vy_out[1], motionOffset.vy);
  <span class="ModelicaFunction">connect</span>(vehicle.wz_out[1], motionOffset.wz);
  <span class="ModelicaFunction">connect</span>(motionOffset.vy_offset, headingAngle.u1);
  <span class="ModelicaFunction">connect</span>(motionOffset.vx_offset, headingAngle.u2);
  <span class="ModelicaFunction">connect</span>(add.u1, headingAngle.y);
  <span class="ModelicaFunction">connect</span>(add.u2, realExpression2.y);
  <span class="ModelicaFunction">connect</span>(add.y, inverseBlockConstraints.u2);
<span class="ModelicaKeyword">end </span>DirectionInput;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE DirectionInput_SaturatedTyre<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="OpenPBS.VehicleModels.DirectionInputI.png" alt="OpenPBS.VehicleModels.DirectionInput_SaturatedTyre" align="right" style="border: 1px solid" width="80" height="80">
<a name="OpenPBS.VehicleModels.DirectionInput_SaturatedTyre"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.DirectionInput_SaturatedTyre</h2>
<p>
<span class="ModelicaDescription">Single track model with direction of travel at front axle as input</span>
<br>
<br><img src="OpenPBS.VehicleModels.DirectionInputD.png" alt="OpenPBS.VehicleModels.DirectionInput_SaturatedTyre">
</p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td>Integer</td><td>nu</td><td>2</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>na</td><td>3</td><td>&nbsp;</td></tr>
<tr><td>Real</td><td>mu</td><td>&nbsp;</td><td>Friction coefficient</td></tr>
<tr><td><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>VehicleModel</a></td><td>paramSet</td><td>&nbsp;</td><td>&nbsp;</td></tr>
</table>
<h3>Connectors</h3>
<table summary="Connectors" class="ModelicaTableConnectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>delta_out</td><td>&nbsp;</td></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>front_direction_in</td><td>Direction of travel at first axle</td></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>vx_in</td><td>First unit velocity input</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> DirectionInput_SaturatedTyre
  <span class="ModelicaComment">&quot;Single track model with direction of travel at front axle as input&quot;</span>
  <span class="ModelicaKeyword">parameter </span>Integer nu=2;
  <span class="ModelicaKeyword">parameter </span>Integer na=3;

  <span class="ModelicaKeyword">parameter </span>Real mu <span class="ModelicaComment">&quot;Friction coefficient&quot;</span>;


  <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.SingleTrack_SaturatedTyre"
>SingleTrack_SaturatedTyre</a> vehicle(            mode=2, paramSet=paramSet,
    nu=nu,
    na=na,
    mu=mu);
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.InverseBlockConstraints"
>Modelica.Blocks.Math.InverseBlockConstraints</a> inverseBlockConstraints;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> delta_out;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> front_direction_in
    <span class="ModelicaComment">&quot;Direction of travel at first axle&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> vx_in <span class="ModelicaComment">&quot;First unit velocity input&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Atan2"
>Modelica.Blocks.Math.Atan2</a> headingAngle;
  <a href="OpenPBS_Components.html#OpenPBS.Components.MotionOffset"
>Components.MotionOffset</a> motionOffset(y_offset=-paramSet.w[1, 1]/2,
      x_offset=vehicle.Lcog[1, 1]);
  <span class="ModelicaKeyword">parameter </span><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>Vehicles.Base.VehicleModel</a> paramSet;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.RealExpression"
>Modelica.Blocks.Sources.RealExpression</a> realExpression2(y=vehicle.pz[1]);
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Add"
>Modelica.Blocks.Math.Add</a> add;
<span class="ModelicaKeyword">equation </span>

  <span class="ModelicaFunction">connect</span>(vehicle.delta_in, inverseBlockConstraints.y2);
  <span class="ModelicaFunction">connect</span>(inverseBlockConstraints.u1, front_direction_in);
  <span class="ModelicaFunction">connect</span>(vehicle.vx_in, vx_in);
  <span class="ModelicaFunction">connect</span>(inverseBlockConstraints.y1, delta_out);
  <span class="ModelicaFunction">connect</span>(vehicle.vx_out[1], motionOffset.vx);
  <span class="ModelicaFunction">connect</span>(vehicle.vy_out[1], motionOffset.vy);
  <span class="ModelicaFunction">connect</span>(vehicle.wz_out[1], motionOffset.wz);
  <span class="ModelicaFunction">connect</span>(motionOffset.vy_offset, headingAngle.u1);
  <span class="ModelicaFunction">connect</span>(motionOffset.vx_offset, headingAngle.u2);
  <span class="ModelicaFunction">connect</span>(add.u1, headingAngle.y);
  <span class="ModelicaFunction">connect</span>(add.u2, realExpression2.y);
  <span class="ModelicaFunction">connect</span>(add.y, inverseBlockConstraints.u2);
<span class="ModelicaKeyword">end </span>DirectionInput_SaturatedTyre;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE CurvatureInput<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="OpenPBS.VehicleModels.CurvatureInputI.png" alt="OpenPBS.VehicleModels.CurvatureInput" align="right" style="border: 1px solid" width="80" height="80">
<a name="OpenPBS.VehicleModels.CurvatureInput"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.CurvatureInput</h2>
<p>
<span class="ModelicaDescription">Steady-state curve</span>
<br>
<br><img src="OpenPBS.VehicleModels.CurvatureInputD.png" alt="OpenPBS.VehicleModels.CurvatureInput">
</p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td>Integer</td><td>nu</td><td>2</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>na</td><td>3</td><td>&nbsp;</td></tr>
<tr><td><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>VehicleModel</a></td><td>paramSet</td><td>&nbsp;</td><td>&nbsp;</td></tr>
</table>
<h3>Connectors</h3>
<table summary="Connectors" class="ModelicaTableConnectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>curvature_in</td><td>&nbsp;</td></tr>
<tr><td>input <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>vx_in</td><td>&nbsp;</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>curvature_out[nu, na]</td><td>Curvature per axle</td></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>delta_out</td><td>Front steer angle</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> CurvatureInput <span class="ModelicaComment">&quot;Steady-state curve&quot;</span>
  <span class="ModelicaKeyword">parameter </span>Integer nu=2;
  <span class="ModelicaKeyword">parameter </span>Integer na=3;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> curvature_in;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.InverseBlockConstraints"
>Modelica.Blocks.Math.InverseBlockConstraints</a> inverseBlockConstraints;
  <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.SingleTrack"
>SingleTrack</a>               vehicle(paramSet=paramSet,
    theta(start=<span class="ModelicaFunction">ones</span>(nu - 1)*0.001),
    wz(start=<span class="ModelicaFunction">ones</span>(nu)*0.001),
    vy(start=<span class="ModelicaFunction">ones</span>(nu)*0.001),
    mode=3,
    alpha(start=-0.001*<span class="ModelicaFunction">ones</span>(nu, na)),
    Fcx(start=<span class="ModelicaFunction">ones</span>(nu - 1)*1000),
    Fcy(start=<span class="ModelicaFunction">ones</span>(nu - 1)*10000));
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> vx_in;
  <a href="OpenPBS_Manoeuvres_Blocks.html#OpenPBS.Manoeuvres.Blocks.Curvature"
>Manoeuvres.Blocks.Curvature</a> curvature(
    nu=paramSet.nu,
    na=paramSet.na,
    Lcog=vehicle.Lcog);
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> curvature_out[nu,na]
    <span class="ModelicaComment">&quot;Curvature per axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>Vehicles.Base.VehicleModel</a> paramSet;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> delta_out <span class="ModelicaComment">&quot;Front steer angle&quot;</span>;
<span class="ModelicaKeyword">equation </span>
  <span class="ModelicaFunction">connect</span>(vehicle.vx_out,curvature. vx);
  <span class="ModelicaFunction">connect</span>(vehicle.vy_out,curvature. vy);
  <span class="ModelicaFunction">connect</span>(vehicle.wz_out,curvature. wz);
  <span class="ModelicaFunction">connect</span>(curvature.y[1, 1],inverseBlockConstraints. u2);
  <span class="ModelicaFunction">connect</span>(curvature_in, inverseBlockConstraints.u1);
  <span class="ModelicaFunction">connect</span>(vx_in, vehicle.vx_in);
  <span class="ModelicaFunction">connect</span>(curvature.y, curvature_out);
  <span class="ModelicaFunction">connect</span>(inverseBlockConstraints.y1, delta_out);
<span class="ModelicaComment">//   connect(inverseBlockConstraints.y2, vehicle.delta_in[1, 1]) annotation (</span>
<span class="ModelicaComment">//       Line(points={{28.4,40},{22,40},{22,6},{34,6},{34,-1},{28,-1}}, color={0,</span>
<span class="ModelicaComment">//           0,127}));</span>
  <span class="ModelicaFunction">connect</span>(inverseBlockConstraints.y2, vehicle.delta_in);
<span class="ModelicaKeyword">end </span>CurvatureInput;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE VerticalForces<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="OpenPBS.VehicleModels.VerticalForces"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.VerticalForces</h2>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>VehicleModel</a></td><td>paramSet</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>nu</td><td>paramSet.nu</td><td>Number of units</td></tr>
<tr><td>Integer</td><td>na</td><td>paramSet.na</td><td>Max number of axles per unit</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Mass</a></td><td>m[nu]</td><td>paramSet.m</td><td>[kg]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>L[nu, na]</td><td>paramSet.L</td><td>Axle positions relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>X[nu]</td><td>paramSet.X</td><td>C.g. position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>A[nu]</td><td>paramSet.A</td><td>Front coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>B[nu]</td><td>paramSet.B</td><td>Rear coupling position relative first axle [m]</td></tr>
<tr><td>Integer</td><td>axlegroups[nu, na]</td><td>paramSet.axlegroups</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> VerticalForces
  <span class="ModelicaKeyword">parameter </span><a href="OpenPBS_Vehicles_Base.html#OpenPBS.Vehicles.Base.VehicleModel"
>OpenPBS.Vehicles.Base.VehicleModel</a> paramSet;
  <span class="ModelicaKeyword">parameter </span>Integer nu=paramSet.nu <span class="ModelicaComment">&quot;Number of units&quot;</span>;
  <span class="ModelicaKeyword">parameter </span>Integer na=paramSet.na <span class="ModelicaComment">&quot;Max number of axles per unit&quot;</span>;

  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Modelica.SIunits.Mass</a>[nu] m=paramSet.m;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] L=paramSet.L
    <span class="ModelicaComment">&quot;Axle positions relative first axle of each unit&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] X=paramSet.X
    <span class="ModelicaComment">&quot;C.g. position relative first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] A=paramSet.A
    <span class="ModelicaComment">&quot;Front coupling position relative first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] B=paramSet.B
    <span class="ModelicaComment">&quot;Rear coupling position relative first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span>Integer[nu,na] axlegroups=paramSet.axlegroups;
<span class="ModelicaComment">//   parameter Modelica.SIunits.TranslationalSpringConstant[nu,na] kz(start=paramSet.kz,fixed=false);</span>

  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] Lcog = L-<span class="ModelicaFunction">matrix</span>(X)*<span class="ModelicaFunction">ones</span>(1,na)
    <span class="ModelicaComment">&quot;Axle positions relative c.g.&quot;</span>;
  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Bcog = B-X;
  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Acog = A-X;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a>[nu,na] Fz(start=1e4*<span class="ModelicaFunction">ones</span>(nu,na))
    <span class="ModelicaComment">&quot;Vertical force at each axle&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fcz[nu-1] <span class="ModelicaComment">&quot;Vertical force at couplings&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> fz_front[nu] <span class="ModelicaComment">&quot;Vertical force of front axle groups&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> fz_rear[nu] <span class="ModelicaComment">&quot;Vertical force of rear axle groups&quot;</span>;

<span class="ModelicaKeyword">equation </span>
  <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
     <span class="ModelicaKeyword">if </span><span class="ModelicaFunction">max</span>(axlegroups[i,:])&lt;2<span class="ModelicaKeyword"> then</span>
       fz_rear[i]=0;
     <span class="ModelicaKeyword">end if</span>;
    <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
      <span class="ModelicaKeyword">if </span>axlegroups[i,j]==1<span class="ModelicaKeyword"> then</span>
        Fz[i,j]=fz_front[i];
      <span class="ModelicaKeyword">elseif </span>axlegroups[i,j]==2<span class="ModelicaKeyword"> then</span>
        Fz[i,j]=fz_rear[i];
      <span class="ModelicaKeyword">else</span>
        Fz[i,j]=1;
      <span class="ModelicaKeyword">end if</span>;
    <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaKeyword">end for</span>;

  m*Modelica.Constants.g_n=<span class="ModelicaFunction">vector</span>(Fz*<span class="ModelicaFunction">ones</span>(na,1)-[<span class="ModelicaFunction">matrix</span>(Fcz);0]+[0;<span class="ModelicaFunction">matrix</span>(Fcz)]);

  <span class="ModelicaFunction">zeros</span>(nu)=<span class="ModelicaFunction">vector</span>(Lcog.*Fz*<span class="ModelicaFunction">ones</span>(na,1)-<span class="ModelicaFunction">matrix</span>(Bcog).*[<span class="ModelicaFunction">matrix</span>(Fcz);0]+<span class="ModelicaFunction">matrix</span>(Acog).*[0;<span class="ModelicaFunction">matrix</span>(Fcz)]);

<span class="ModelicaKeyword">end </span>VerticalForces;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE Roll<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="OpenPBS.VehicleModels.Roll"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.Roll</h2>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> Roll

<span class="ModelicaKeyword">end </span>Roll;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE Longitudinal<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="OpenPBS.VehicleModels.Longitudinal"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.Longitudinal</h2>
<p>
<br><img src="OpenPBS.VehicleModels.LongitudinalD.png" alt="OpenPBS.VehicleModels.Longitudinal">
</p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="OpenPBS_Vehicles_Vehicles.html#OpenPBS.Vehicles.Vehicles.Adouble6x4"
>Adouble6x4</a></td><td>paramSet</td><td>redeclare parameter Vehicles...</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>mode</td><td>2</td><td>1: Normal, 2: Quasistatic</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Velocity</a></td><td>vx0</td><td>15</td><td>[m/s]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Angle</a></td><td>inclination_angle</td><td>&nbsp;</td><td>Inclination angle, positive for uphill driving [rad]</td></tr>
<tr><td>Integer</td><td>nu</td><td>paramSet.nu</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>na</td><td>paramSet.na</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Mass</a></td><td>m[nu]</td><td>paramSet.m</td><td>[kg]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>L[nu, na]</td><td>paramSet.L</td><td>Axle positions relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>X[nu]</td><td>paramSet.X</td><td>C.g. position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>A[nu]</td><td>paramSet.A</td><td>Front coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>B[nu]</td><td>paramSet.B</td><td>Rear coupling position relative first axle [m]</td></tr>
<tr><td>Integer</td><td>axlegroups[nu, na]</td><td>paramSet.axlegroups</td><td>&nbsp;</td></tr>
<tr><td>Boolean</td><td>driven[nu, na]</td><td>paramSet.driven</td><td>&nbsp;</td></tr>
<tr><td>Real</td><td>drag_coefficient</td><td>paramSet.drag_coefficient</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</a></td><td>frontal_area</td><td>paramSet.frontal_area</td><td>[m2]</td></tr>
<tr><td>Real</td><td>rolling_resistance_coefficient</td><td>paramSet.rolling_resistance_...</td><td>Rolling resistance force as a function of vertical force</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Force</a></td><td>max_thrust_force_vx0</td><td>paramSet.max_thrust_force_vx0</td><td>[N]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Power"
>Power</a></td><td>max_engine_power</td><td>paramSet.max_engine_power</td><td>[W]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Density</a></td><td>air_density</td><td>1.204</td><td>[kg/m3]</td></tr>
<tr><td>Integer</td><td>n_driven</td><td>sum(Modelica.Math.BooleanVec...</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">partial </span><span class="ModelicaKeyword">model</span> Longitudinal

  <span class="ModelicaKeyword">replaceable </span><span class="ModelicaKeyword">parameter </span><a href="OpenPBS_Vehicles_Vehicles.html#OpenPBS.Vehicles.Vehicles.Adouble6x4"
>Vehicles.Vehicles.Adouble6x4</a> paramSet <span class="ModelicaKeyword">constrainedby </span>
    Vehicles.Base.VehicleModel;

   <span class="ModelicaKeyword">parameter </span>Integer mode=2
    <span class="ModelicaComment">&quot;1: Normal, 2: Quasistatic&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Modelica.SIunits.Velocity</a> vx0=15;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Modelica.SIunits.Angle</a> inclination_angle <span class="ModelicaComment">&quot;Inclination angle, positive for uphill driving&quot;</span>;

  <span class="ModelicaKeyword">parameter </span>Integer nu=paramSet.nu;
  <span class="ModelicaKeyword">parameter </span>Integer na=paramSet.na;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Modelica.SIunits.Mass</a>[nu] m=paramSet.m;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] L=paramSet.L
    <span class="ModelicaComment">&quot;Axle positions relative first axle of each unit&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] X=paramSet.X
    <span class="ModelicaComment">&quot;C.g. position relative first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] A=paramSet.A
    <span class="ModelicaComment">&quot;Front coupling position relative first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] B=paramSet.B
    <span class="ModelicaComment">&quot;Rear coupling position relative first axle&quot;</span>;
  <span class="ModelicaKeyword">parameter </span>Integer[nu,na] axlegroups=paramSet.axlegroups;
  <span class="ModelicaKeyword">parameter </span>Boolean[nu,na] driven=paramSet.driven;
  <span class="ModelicaKeyword">parameter </span>Real drag_coefficient=paramSet.drag_coefficient;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Modelica.SIunits.Area</a> frontal_area=paramSet.frontal_area;
  <span class="ModelicaKeyword">parameter </span>Real rolling_resistance_coefficient=paramSet.rolling_resistance_coefficient <span class="ModelicaComment">&quot;Rolling resistance force as a function of vertical force&quot;</span>;


  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> max_thrust_force_vx0=paramSet.max_thrust_force_vx0;
  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Power"
>Modelica.SIunits.Power</a> max_engine_power=paramSet.max_engine_power;

  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Modelica.SIunits.Density</a> air_density=1.204;

  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu,na] Lcog = L-<span class="ModelicaFunction">matrix</span>(X)*<span class="ModelicaFunction">ones</span>(1,na)
    <span class="ModelicaComment">&quot;Axle positions relative c.g.&quot;</span>;
  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Bcog = B-X;
  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Modelica.SIunits.Length</a>[nu] Acog = A-X;

  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] rx0=TM*[0;<span class="ModelicaFunction">matrix</span>(B[1:nu-1]-A[2:nu])]*<span class="ModelicaFunction">ones</span>(1,na)+L;
  <span class="ModelicaKeyword">final </span><span class="ModelicaKeyword">parameter </span>Integer TM[nu,nu]=<span class="ModelicaFunction">Functions.tril</span>(nu);
  <span class="ModelicaKeyword">parameter </span>Integer n_driven=<span class="ModelicaFunction">sum</span>(<span class="ModelicaFunction">Modelica.Math.BooleanVectors.countTrue</span>(driven));

  <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.VerticalForces"
>OpenPBS.VehicleModels.VerticalForces</a> verticalForces(paramSet=paramSet);

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a> ax[nu];
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Modelica.SIunits.Velocity</a> vx[nu];

  <span class="ModelicaComment">/* Tire forces */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fx[nu,na] <span class="ModelicaComment">&quot;Vehicle longitudinal force per axle&quot;</span>;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fxd <span class="ModelicaComment">&quot;Drive force (applied to each driven axle)&quot;</span>;


  <span class="ModelicaComment">/* Coupling forces */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fcx[nu-1] <span class="ModelicaComment">&quot;Longitudinal coupling forces&quot;</span>;

  <span class="ModelicaComment">/* Chassis forces */</span>
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> Fxa <span class="ModelicaComment">&quot;Aerodynamic force&quot;</span>;

  <span class="ModelicaComment">/* Derivative variables */</span>
  <span class="ModelicaComment">//Modelica.SIunits.Acceleration[nu] d_vx;</span>
  <span class="ModelicaComment">//Modelica.SIunits.Velocity[nu] d_rx;</span>

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>Modelica.SIunits.Position</a>[nu,na] rx(start=rx0);

  Real[nu,na] friction_usage=Fx./verticalForces.Fz;


<span class="ModelicaKeyword">initial </span><span class="ModelicaKeyword">equation </span>
   vx=vx0*<span class="ModelicaFunction">ones</span>(nu);
<span class="ModelicaKeyword">equation </span>
  <span class="ModelicaKeyword">if </span>mode==1<span class="ModelicaKeyword"> then</span>
    <span class="ModelicaFunction">der</span>(vx)=ax;
  <span class="ModelicaKeyword">else</span>
    <span class="ModelicaFunction">der</span>(vx)=<span class="ModelicaFunction">zeros</span>(nu);
  <span class="ModelicaKeyword">end if</span>;

<span class="ModelicaComment">//   d_vx=ax;</span>

  Fxa = 0.5*air_density*vx[1]^2*drag_coefficient*frontal_area <span class="ModelicaComment">&quot;Aerodynamic drag&quot;</span>;

  <span class="ModelicaComment">/* Tire force */</span>
  <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
      <span class="ModelicaKeyword">if </span>driven[i,j]<span class="ModelicaKeyword"> then</span>
        Fx[i,j]=Fxd-verticalForces.Fz[i,j]*<span class="ModelicaFunction">sin</span>(inclination_angle)-verticalForces.Fz[i,j]*rolling_resistance_coefficient;
      <span class="ModelicaKeyword">else</span>
        Fx[i,j]=-verticalForces.Fz[i,j]*<span class="ModelicaFunction">sin</span>(inclination_angle)-verticalForces.Fz[i,j]*rolling_resistance_coefficient;
      <span class="ModelicaKeyword">end if</span>;
    <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaKeyword">end for</span>;


  <span class="ModelicaComment">/* Kinematic constraints in couplings */</span>
   <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu-1<span class="ModelicaKeyword"> loop</span>
     ax[i+1] = ax[i];
   <span class="ModelicaKeyword">end for</span>;

  m.*ax=<span class="ModelicaFunction">vector</span>([<span class="ModelicaFunction">matrix</span>(Fxa);<span class="ModelicaFunction">zeros</span>(nu-1,1)]+Fx*<span class="ModelicaFunction">ones</span>(na,1)-[<span class="ModelicaFunction">matrix</span>(Fcx);0]+[0;<span class="ModelicaFunction">matrix</span>(Fcx)]);

  <span class="ModelicaComment">/* Axle global positions */</span>
  <span class="ModelicaFunction">der</span>(rx)=<span class="ModelicaKeyword">if </span>mode==1<span class="ModelicaKeyword"> then </span><span class="ModelicaFunction">matrix</span>(vx)*<span class="ModelicaFunction">ones</span>(1,na)<span class="ModelicaKeyword"> else </span><span class="ModelicaFunction">zeros</span>(nu,na);
<span class="ModelicaKeyword">end </span>Longitudinal;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE LongitudinalAccelerationQS<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="OpenPBS.VehicleModels.Lon829f774761c73fbeionQSI.png" alt="OpenPBS.VehicleModels.LongitudinalAccelerationQS" align="right" style="border: 1px solid" width="80" height="80">
<a name="OpenPBS.VehicleModels.LongitudinalAccelerationQS"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.LongitudinalAccelerationQS</h2>
<p>
<span class="ModelicaDescription">Use max thrust force distributed on driving axles and solve for the highest inclination angle where the desired acceleration can be achieved</span>
<br>
<br><img src="OpenPBS.VehicleModels.Lon829f774761c73fbeionQSD.png" alt="OpenPBS.VehicleModels.LongitudinalAccelerationQS">
</p>
<h3>Information</h3>
<p><span class="ModelicaBaseClass">Extends from <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.Longitudinal"
>Longitudinal</a>.</span></p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="OpenPBS_Vehicles_Vehicles.html#OpenPBS.Vehicles.Vehicles.Adouble6x4"
>Adouble6x4</a></td><td>paramSet</td><td>redeclare parameter Vehicles...</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>mode</td><td>2</td><td>1: Normal, 2: Quasistatic</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Velocity</a></td><td>vx0</td><td>0</td><td>[m/s]</td></tr>
<tr><td>Integer</td><td>nu</td><td>paramSet.nu</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>na</td><td>paramSet.na</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Mass</a></td><td>m[nu]</td><td>paramSet.m</td><td>[kg]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>L[nu, na]</td><td>paramSet.L</td><td>Axle positions relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>X[nu]</td><td>paramSet.X</td><td>C.g. position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>A[nu]</td><td>paramSet.A</td><td>Front coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>B[nu]</td><td>paramSet.B</td><td>Rear coupling position relative first axle [m]</td></tr>
<tr><td>Integer</td><td>axlegroups[nu, na]</td><td>paramSet.axlegroups</td><td>&nbsp;</td></tr>
<tr><td>Boolean</td><td>driven[nu, na]</td><td>paramSet.driven</td><td>&nbsp;</td></tr>
<tr><td>Real</td><td>drag_coefficient</td><td>paramSet.drag_coefficient</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</a></td><td>frontal_area</td><td>paramSet.frontal_area</td><td>[m2]</td></tr>
<tr><td>Real</td><td>rolling_resistance_coefficient</td><td>paramSet.rolling_resistance_...</td><td>Rolling resistance force as a function of vertical force</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Force</a></td><td>max_thrust_force_vx0</td><td>paramSet.max_thrust_force_vx0</td><td>[N]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Power"
>Power</a></td><td>max_engine_power</td><td>paramSet.max_engine_power</td><td>[W]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Density</a></td><td>air_density</td><td>1.204</td><td>[kg/m3]</td></tr>
<tr><td>Integer</td><td>n_driven</td><td>sum(Modelica.Math.BooleanVec...</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Acceleration</a></td><td>acceleration_demand</td><td>0.02</td><td>Required acceleration [m/s2]</td></tr>
<tr><td>Real</td><td>friction</td><td>1</td><td>&nbsp;</td></tr>
</table>
<h3>Connectors</h3>
<table summary="Connectors" class="ModelicaTableConnectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>inclination_out</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> LongitudinalAccelerationQS
  <span class="ModelicaComment">&quot;Use max thrust force distributed on driving axles and solve for the highest inclination angle where the desired acceleration can be achieved&quot;</span>
  <span class="ModelicaKeyword">extends </span><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.Longitudinal"
>Longitudinal</a>(mode=2, inclination_angle(fixed=false,start=0),vx0=0);

  <span class="ModelicaKeyword">parameter </span><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</a> acceleration_demand=0.02 <span class="ModelicaComment">&quot;Required acceleration&quot;</span>;
  <span class="ModelicaKeyword">parameter </span>Real friction=1;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> max_force=<span class="ModelicaFunction">min</span>(limiting_force)*friction;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> inclination_out=inclination_angle;

<span class="ModelicaKeyword">protected </span>
  Real limiting_force[nu,na];
<span class="ModelicaKeyword">initial </span><span class="ModelicaKeyword">equation </span>
  Fxd=<span class="ModelicaFunction">min</span>(max_force,<span class="ModelicaFunction">min</span>(max_thrust_force_vx0,max_engine_power/<span class="ModelicaFunction">max</span>(0.1,vx[1]))/n_driven);

<span class="ModelicaKeyword">equation </span>
  <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
      limiting_force[i,j] = <span class="ModelicaKeyword">if </span>driven[i,j]<span class="ModelicaKeyword"> then </span>verticalForces.Fz[i,j]<span class="ModelicaKeyword"> else </span>1e10;
    <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaKeyword">end for</span>;
  ax[1]=acceleration_demand;

<span class="ModelicaKeyword">end </span>LongitudinalAccelerationQS;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE LongitudinalAcceleration<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="OpenPBS.VehicleModels.Lon829f774761c73fbeionQSI.png" alt="OpenPBS.VehicleModels.LongitudinalAcceleration" align="right" style="border: 1px solid" width="80" height="80">
<a name="OpenPBS.VehicleModels.LongitudinalAcceleration"></a><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels"
>OpenPBS.VehicleModels</a>.LongitudinalAcceleration</h2>
<p>
<span class="ModelicaDescription">Use max thrust force distributed on driving axles for dynamic simulation</span>
<br>
<br><img src="OpenPBS.VehicleModels.Lon9f62fcb97358764dationD.png" alt="OpenPBS.VehicleModels.LongitudinalAcceleration">
</p>
<h3>Information</h3>
<p><span class="ModelicaBaseClass">Extends from <a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.Longitudinal"
>Longitudinal</a>.</span></p>
<h3>Parameters</h3>
<table summary="Parameters" class="ModelicaTableParameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="OpenPBS_Vehicles_Vehicles.html#OpenPBS.Vehicles.Vehicles.Adouble6x4"
>Adouble6x4</a></td><td>paramSet</td><td>redeclare parameter Vehicles...</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>mode</td><td>1</td><td>1: Normal, 2: Quasistatic</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Velocity"
>Velocity</a></td><td>vx0</td><td>15</td><td>[m/s]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>Angle</a></td><td>inclination_angle</td><td>0</td><td>Inclination angle, positive for uphill driving [rad]</td></tr>
<tr><td>Integer</td><td>nu</td><td>paramSet.nu</td><td>&nbsp;</td></tr>
<tr><td>Integer</td><td>na</td><td>paramSet.na</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>Mass</a></td><td>m[nu]</td><td>paramSet.m</td><td>[kg]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>L[nu, na]</td><td>paramSet.L</td><td>Axle positions relative first axle of each unit [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>X[nu]</td><td>paramSet.X</td><td>C.g. position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>A[nu]</td><td>paramSet.A</td><td>Front coupling position relative first axle [m]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Length"
>Length</a></td><td>B[nu]</td><td>paramSet.B</td><td>Rear coupling position relative first axle [m]</td></tr>
<tr><td>Integer</td><td>axlegroups[nu, na]</td><td>paramSet.axlegroups</td><td>&nbsp;</td></tr>
<tr><td>Boolean</td><td>driven[nu, na]</td><td>paramSet.driven</td><td>&nbsp;</td></tr>
<tr><td>Real</td><td>drag_coefficient</td><td>paramSet.drag_coefficient</td><td>&nbsp;</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</a></td><td>frontal_area</td><td>paramSet.frontal_area</td><td>[m2]</td></tr>
<tr><td>Real</td><td>rolling_resistance_coefficient</td><td>paramSet.rolling_resistance_...</td><td>Rolling resistance force as a function of vertical force</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Force</a></td><td>max_thrust_force_vx0</td><td>paramSet.max_thrust_force_vx0</td><td>[N]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Power"
>Power</a></td><td>max_engine_power</td><td>paramSet.max_engine_power</td><td>[W]</td></tr>
<tr><td><a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Density</a></td><td>air_density</td><td>1.204</td><td>[kg/m3]</td></tr>
<tr><td>Integer</td><td>n_driven</td><td>sum(Modelica.Math.BooleanVec...</td><td>&nbsp;</td></tr>
<tr><td>Real</td><td>friction</td><td>1</td><td>&nbsp;</td></tr>
</table>
<h3>Connectors</h3>
<table summary="Connectors" class="ModelicaTableConnectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>output <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</a></td><td>s_out</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">model</span> LongitudinalAcceleration
  <span class="ModelicaComment">&quot;Use max thrust force distributed on driving axles for dynamic simulation&quot;</span>
  <span class="ModelicaKeyword">extends </span><a href="OpenPBS_VehicleModels.html#OpenPBS.VehicleModels.Longitudinal"
>Longitudinal</a>(mode=1, inclination_angle=0);
  <span class="ModelicaKeyword">parameter </span>Real friction=1;

  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_SIunits.html#Modelica.SIunits.Force"
>Modelica.SIunits.Force</a> max_force=<span class="ModelicaFunction">min</span>(limiting_force)*friction;
  <a href="file:///C:/Program%20Files%20(x86)/Dymola%202018/Modelica/Library/Modelica%203.2.2/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</a> s_out=rx[1,1];
<span class="ModelicaKeyword">protected </span>
  Real limiting_force[nu,na];

<span class="ModelicaKeyword">equation </span>
  Fxd=<span class="ModelicaFunction">min</span>(max_force,<span class="ModelicaFunction">min</span>(max_thrust_force_vx0,max_engine_power/<span class="ModelicaFunction">max</span>(0.1,vx[1]))/n_driven);
  <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:nu<span class="ModelicaKeyword"> loop</span>
    <span class="ModelicaKeyword">for </span>j<span class="ModelicaKeyword"> in </span>1:na<span class="ModelicaKeyword"> loop</span>
      limiting_force[i,j] = <span class="ModelicaKeyword">if </span>driven[i,j]<span class="ModelicaKeyword"> then </span>verticalForces.Fz[i,j]<span class="ModelicaKeyword"> else </span>1e10;
    <span class="ModelicaKeyword">end for</span>;
  <span class="ModelicaKeyword">end for</span>;
<span class="ModelicaKeyword">end </span>LongitudinalAcceleration;
</div>
<hr>
<address>
<a href="http://www.3ds.com/">Automatically generated</a> Sun Jul 16 11:17:01 2017.
</address>
</body>
</html>
